# Story 1.6: Next.js Shell UI Basic Setup and Health Check

## Status
Ready for Review

## Story
**As a** developer,
**I want** a basic Next.js application with TypeScript and Tailwind CSS configured,
**so that** I have the foundation for building the Shell UI interface.

## Acceptance Criteria
1. apps/shell-ui/ initialized with Next.js 14+ using App Router and TypeScript
2. Tailwind CSS 3.4+ configured with tailwind.config.js and globals.css
3. Root layout (app/layout.tsx) created with basic HTML structure and metadata
4. Home page (app/page.tsx) displays "Kyros PoC" heading and link to health check status
5. TypeScript configured with strict mode enabled in tsconfig.json
6. ESLint configured for Next.js and React best practices
7. app/api/health/route.ts API route created that proxies FastAPI /health endpoint
8. Client-side fetch on home page displays API health status (fetches from /api/health)
9. Next.js app successfully builds (`npm run build`) without TypeScript errors
10. Next.js app accessible at http://localhost:3000 with health status visible on home page
11. Environment variables configured in .env.local for API_BASE_URL (http://api:8000)

## Tasks / Subtasks
- [ ] **Task 1: Initialize Next.js application** (AC: 1)
  - [ ] Create `apps/shell-ui/` directory if not exists
  - [ ] Run `npx create-next-app@latest .` with App Router and TypeScript
  - [ ] Select options: TypeScript (Yes), ESLint (Yes), Tailwind CSS (Yes), App Router (Yes)
  - [ ] Verify package.json created with Next.js 14+
  - [ ] Verify app/ directory created with App Router structure
  - [ ] Install dependencies: `npm install`

- [ ] **Task 2: Configure Tailwind CSS** (AC: 2)
  - [ ] Verify tailwind.config.js created by create-next-app
  - [ ] Update content paths to include all app/ components
  - [ ] Verify app/globals.css includes Tailwind directives
  - [ ] Add custom color palette for Kyros branding (optional)
  - [ ] Test Tailwind classes work in components

- [ ] **Task 3: Configure TypeScript** (AC: 5)
  - [ ] Verify tsconfig.json created
  - [ ] Enable strict mode: `"strict": true`
  - [ ] Enable noUnusedLocals and noUnusedParameters
  - [ ] Configure path aliases: `@/*` for src imports
  - [ ] Add types for Next.js: `@types/react`, `@types/node`
  - [ ] Verify TypeScript compilation works: `npx tsc --noEmit`

- [ ] **Task 4: Configure ESLint** (AC: 6)
  - [ ] Verify .eslintrc.json created with Next.js config
  - [ ] Add react-hooks plugin for React best practices
  - [ ] Add rules for unused variables and imports
  - [ ] Configure ESLint to work with TypeScript
  - [ ] Add lint script to package.json: `"lint": "next lint"`
  - [ ] Run linter and fix any initial issues: `npm run lint`

- [ ] **Task 5: Create root layout** (AC: 3)
  - [ ] Create `app/layout.tsx` with RootLayout component
  - [ ] Define HTML structure: html, body tags
  - [ ] Add metadata: title, description
  - [ ] Import globals.css for Tailwind
  - [ ] Add Inter font from next/font/google
  - [ ] Set up proper TypeScript types for children prop

- [ ] **Task 6: Create home page** (AC: 4, 8)
  - [ ] Create `app/page.tsx` as Home component
  - [ ] Add "Kyros PoC" heading with Tailwind styling
  - [ ] Add health status display section
  - [ ] Implement client-side fetch to /api/health
  - [ ] Display API status (ok/error) with styling
  - [ ] Add loading state while fetching
  - [ ] Handle fetch errors gracefully
  - [ ] Use "use client" directive for client components

- [ ] **Task 7: Create API proxy route** (AC: 7)
  - [ ] Create `app/api/health/` directory
  - [ ] Create `app/api/health/route.ts` with GET handler
  - [ ] Import environment variable API_BASE_URL
  - [ ] Proxy request to FastAPI /health endpoint
  - [ ] Forward response from FastAPI to client
  - [ ] Handle errors if FastAPI is unreachable
  - [ ] Return appropriate HTTP status codes
  - [ ] Add CORS headers if needed

- [ ] **Task 8: Configure environment variables** (AC: 11)
  - [ ] Create `.env.local` file at apps/shell-ui/
  - [ ] Add API_BASE_URL=http://api:8000 for Docker
  - [ ] Create `.env.example` file documenting required variables
  - [ ] Add .env.local to .gitignore (should be there by default)
  - [ ] Update next.config.js to expose env vars to server
  - [ ] Document environment variables in README

- [ ] **Task 9: Create TypeScript type definitions** (AC: 5)
  - [ ] Create `app/types/` directory
  - [ ] Create `app/types/api.ts` for API response types
  - [ ] Define HealthResponse interface matching FastAPI response
  - [ ] Export types for use in components
  - [ ] Verify TypeScript type checking works

- [ ] **Task 10: Test local development** (AC: 10)
  - [ ] Start Next.js dev server: `npm run dev`
  - [ ] Access http://localhost:3000 in browser
  - [ ] Verify "Kyros PoC" heading displays
  - [ ] Verify health status fetches and displays
  - [ ] Check browser console for errors
  - [ ] Test hot reload by editing page.tsx

- [ ] **Task 11: Test production build** (AC: 9)
  - [ ] Run build: `npm run build`
  - [ ] Verify build completes without TypeScript errors
  - [ ] Verify no ESLint errors
  - [ ] Check build output for bundle sizes
  - [ ] Run production server: `npm start`
  - [ ] Test production app at http://localhost:3000
  - [ ] Verify health check still works

- [ ] **Task 12: Update root package.json workspace** (AC: 1)
  - [ ] Verify apps/shell-ui added to workspaces array
  - [ ] Run `npm install` from root to link workspace
  - [ ] Test root scripts work: `npm run build --workspace=apps/shell-ui`
  - [ ] Update root README with shell-ui commands

- [ ] **Task 13: Verify all acceptance criteria** (AC: 1-11)
  - [ ] Confirm Next.js 14+ with App Router initialized
  - [ ] Confirm Tailwind CSS configured and working
  - [ ] Confirm root layout created
  - [ ] Confirm home page shows heading and health status
  - [ ] Confirm TypeScript strict mode enabled
  - [ ] Confirm ESLint configured
  - [ ] Confirm API proxy route works
  - [ ] Confirm health status displays on home page
  - [ ] Confirm build succeeds
  - [ ] Confirm app accessible at localhost:3000
  - [ ] Confirm environment variables configured

## Dev Notes

### Project Context
This is the **sixth and final story** in Epic 1 (Foundation & Shared Configuration). This story creates the Next.js Shell UI foundation that will be extended in Epic 2 (Auth UI, Tenant Selector) and beyond. The health check integration validates the frontend-backend connection.

### Previous Story Insights
- Story 1.4: Configured Docker Compose with shell-ui service on port 3000
- Story 1.5: Created FastAPI /health endpoint on port 8000

This story integrates the Shell UI with the API service using Next.js API routes as a proxy pattern.

### Next.js Application Structure
[Source: architecture/9-frontend-architecture.md]

```
apps/shell-ui/
├── app/                          # Next.js 14 App Router ⭐ THIS STORY
│   ├── layout.tsx                # Root layout ⭐ THIS STORY
│   ├── page.tsx                  # Home page ⭐ THIS STORY
│   ├── globals.css               # Tailwind CSS ⭐ THIS STORY
│   ├── login/                    # Mock login page (Epic 2)
│   ├── tenant/                   # Tenant routes (Epic 2+)
│   └── api/
│       └── health/
│           └── route.ts          # Health proxy route ⭐ THIS STORY
├── components/                   # React components (Epic 2+)
├── hooks/                        # Custom hooks (Epic 2+)
├── lib/                          # Utilities (Epic 2+)
├── types/
│   └── api.ts                    # API type definitions ⭐ THIS STORY
├── public/                       # Static assets
├── package.json                  # Dependencies ⭐ THIS STORY
├── tsconfig.json                 # TypeScript config ⭐ THIS STORY
├── tailwind.config.js            # Tailwind config ⭐ THIS STORY
├── next.config.js                # Next.js config ⭐ THIS STORY
├── .eslintrc.json                # ESLint config ⭐ THIS STORY
├── .env.local                    # Environment variables ⭐ THIS STORY
└── .env.example                  # Env template ⭐ THIS STORY
```

### Root Layout Component
[Source: architecture/9-frontend-architecture.md + prd/epic-1 AC #3]

**app/layout.tsx:**
```typescript
import type { Metadata } from 'next'
import { Inter } from 'next/font/google'
import './globals.css'

const inter = Inter({ subsets: ['latin'] })

export const metadata: Metadata = {
  title: 'Kyros SaaS PoC',
  description: 'Multi-tenant dashboard platform with tenant-isolated data access',
}

export default function RootLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <html lang="en">
      <body className={inter.className}>
        {children}
      </body>
    </html>
  )
}
```

### Home Page Component
[Source: prd/epic-1 AC #4, #8]

**app/page.tsx:**
```typescript
'use client'

import { useEffect, useState } from 'react'

interface HealthStatus {
  status: string
  timestamp: string
}

export default function Home() {
  const [health, setHealth] = useState<HealthStatus | null>(null)
  const [loading, setLoading] = useState(true)
  const [error, setError] = useState<string | null>(null)

  useEffect(() => {
    async function fetchHealth() {
      try {
        const response = await fetch('/api/health')
        if (!response.ok) {
          throw new Error('API health check failed')
        }
        const data = await response.json()
        setHealth(data)
      } catch (err) {
        setError(err instanceof Error ? err.message : 'Unknown error')
      } finally {
        setLoading(false)
      }
    }

    fetchHealth()
  }, [])

  return (
    <main className="flex min-h-screen flex-col items-center justify-center p-24">
      <div className="z-10 max-w-5xl w-full items-center justify-center font-mono text-sm">
        <h1 className="text-4xl font-bold text-center mb-8">
          Kyros PoC
        </h1>

        <div className="border border-gray-300 rounded-lg p-6 bg-white shadow-sm">
          <h2 className="text-xl font-semibold mb-4">API Health Status</h2>

          {loading && <p className="text-gray-500">Loading...</p>}

          {error && (
            <div className="text-red-600">
              <p className="font-semibold">Error:</p>
              <p>{error}</p>
            </div>
          )}

          {health && (
            <div className="text-green-600">
              <p><span className="font-semibold">Status:</span> {health.status}</p>
              <p className="text-sm text-gray-500 mt-2">
                Last checked: {new Date(health.timestamp).toLocaleString()}
              </p>
            </div>
          )}
        </div>
      </div>
    </main>
  )
}
```

### API Proxy Route
[Source: architecture/9-frontend-architecture.md + prd/epic-1 AC #7]

**app/api/health/route.ts:**
```typescript
import { NextRequest, NextResponse } from 'next/server'

export async function GET(request: NextRequest) {
  try {
    const apiBaseUrl = process.env.API_BASE_URL || 'http://localhost:8000'
    const response = await fetch(`${apiBaseUrl}/health`, {
      method: 'GET',
      headers: {
        'Content-Type': 'application/json',
      },
    })

    if (!response.ok) {
      return NextResponse.json(
        { error: 'API health check failed' },
        { status: response.status }
      )
    }

    const data = await response.json()
    return NextResponse.json(data)
  } catch (error) {
    console.error('Health check error:', error)
    return NextResponse.json(
      { error: 'Failed to connect to API' },
      { status: 503 }
    )
  }
}
```

### TypeScript Configuration
[Source: architecture/16-coding-standards.md + prd/epic-1 AC #5]

**tsconfig.json:**
```json
{
  "compilerOptions": {
    "target": "ES2022",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "forceConsistentCasingInFileNames": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "preserve",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": ["./*"]
    }
  },
  "include": ["next-env.d.ts", "**/*.ts", "**/*.tsx", ".next/types/**/*.ts"],
  "exclude": ["node_modules"]
}
```

### Tailwind CSS Configuration
[Source: architecture/3-tech-stack.md + prd/epic-1 AC #2]

**tailwind.config.js:**
```javascript
/** @type {import('tailwindcss').Config} */
module.exports = {
  content: [
    './pages/**/*.{js,ts,jsx,tsx,mdx}',
    './components/**/*.{js,ts,jsx,tsx,mdx}',
    './app/**/*.{js,ts,jsx,tsx,mdx}',
  ],
  theme: {
    extend: {
      colors: {
        // Custom Kyros brand colors (example)
        'kyros-blue': '#0052cc',
        'kyros-orange': '#ff5722',
      },
    },
  },
  plugins: [],
}
```

**app/globals.css:**
```css
@tailwind base;
@tailwind components;
@tailwind utilities;

:root {
  --foreground-rgb: 0, 0, 0;
  --background-rgb: 255, 255, 255;
}

body {
  color: rgb(var(--foreground-rgb));
  background: rgb(var(--background-rgb));
}
```

### Environment Variables
[Source: prd/epic-1 AC #11]

**.env.local:**
```bash
# FastAPI base URL (use service name in Docker, localhost for local dev)
API_BASE_URL=http://api:8000

# For local development outside Docker:
# API_BASE_URL=http://localhost:8000
```

**.env.example:**
```bash
# API Base URL
# Docker: http://api:8000
# Local: http://localhost:8000
API_BASE_URL=http://api:8000
```

### Next.js Configuration
[Source: architecture/3-tech-stack.md]

**next.config.js:**
```javascript
/** @type {import('next').NextConfig} */
const nextConfig = {
  // Enable standalone output for Docker optimization
  output: 'standalone',

  // Environment variables
  env: {
    API_BASE_URL: process.env.API_BASE_URL,
  },
}

module.exports = nextConfig
```

### Package.json Scripts
[Source: prd/epic-1 AC #9, #10]

**apps/shell-ui/package.json:**
```json
{
  "name": "shell-ui",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "next lint"
  },
  "dependencies": {
    "next": "^14.2.0",
    "react": "^18.3.0",
    "react-dom": "^18.3.0"
  },
  "devDependencies": {
    "@types/node": "^20",
    "@types/react": "^18",
    "@types/react-dom": "^18",
    "autoprefixer": "^10.4.20",
    "eslint": "^8",
    "eslint-config-next": "^14.2.0",
    "postcss": "^8.4.47",
    "tailwindcss": "^3.4.0",
    "typescript": "^5"
  }
}
```

### API Type Definitions
[Source: architecture/16-coding-standards.md + prd/epic-1 AC #5]

**app/types/api.ts:**
```typescript
/**
 * API response types matching FastAPI endpoints.
 */

export interface HealthResponse {
  status: string
  timestamp: string
}

export interface DatabaseHealthResponse extends HealthResponse {
  database: string
  tenant_count: number
}

export interface ApiError {
  error: {
    code: string
    message: string
    details?: Record<string, any>
    timestamp: string
    request_id: string
  }
}
```

### ESLint Configuration
[Source: architecture/16-coding-standards.md + prd/epic-1 AC #6]

**.eslintrc.json:**
```json
{
  "extends": [
    "next/core-web-vitals",
    "next/typescript"
  ],
  "rules": {
    "@typescript-eslint/no-unused-vars": ["error", {
      "argsIgnorePattern": "^_",
      "varsIgnorePattern": "^_"
    }],
    "no-console": ["warn", { "allow": ["warn", "error"] }]
  }
}
```

### Testing Strategy
[Source: architecture/15-testing-strategy.md]

**Manual validation for this story:**

1. **Development server test:**
   ```bash
   cd apps/shell-ui
   npm run dev
   # Open http://localhost:3000
   # Verify health status displays
   ```

2. **Build test:**
   ```bash
   npm run build
   # Verify no TypeScript or ESLint errors
   npm start
   # Test production build works
   ```

3. **Workspace test:**
   ```bash
   cd ../..
   npm run build --workspace=apps/shell-ui
   # Verify workspace integration works
   ```

**No automated tests required for this story** - Epic 2 will add unit tests for components and hooks.

### Reverse Proxy Pattern
[Source: architecture/9-frontend-architecture.md]

Why use Next.js API routes as proxy?
- **Security:** API keys and internal URLs not exposed to browser
- **CORS:** No CORS issues since requests go through same-origin
- **Flexibility:** Easy to add authentication, rate limiting, caching later
- **Type Safety:** Can transform responses to match TypeScript types

### Common Issues and Troubleshooting
[Source: Best practices]

**Issue:** "Cannot connect to API"
- **Solution:** Check API_BASE_URL in .env.local
- **Docker:** Use service name `http://api:8000`
- **Local:** Use `http://localhost:8000`

**Issue:** "Module not found" errors
- **Solution:** Run `npm install` to install dependencies
- **Solution:** Check tsconfig.json paths configuration

**Issue:** "Hydration mismatch" errors
- **Solution:** Ensure client-side state (useEffect) for dynamic content
- **Solution:** Use 'use client' directive for interactive components

### Testing
[Source: architecture/15-testing-strategy.md]

**Definition of Done:**
- Next.js 14+ initialized with App Router
- TypeScript configured with strict mode
- Tailwind CSS working
- ESLint configured
- Root layout created
- Home page displays heading and health status
- API proxy route fetches from FastAPI
- Health status displays correctly
- Build succeeds without errors
- App accessible at localhost:3000
- Environment variables configured
- Documentation complete
- All acceptance criteria met

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-11 | 0.1 | Initial story creation from Epic 1 | James (Dev Agent) |

## Dev Agent Record

### Agent Model Used
_(To be filled during implementation)_

### Debug Log References
_(To be filled during implementation)_

### Completion Notes List
_(To be filled during implementation)_

### File List
**Created:**
_(To be filled during implementation)_

**Modified:**
_(To be filled during implementation)_

## QA Results
_(To be filled by QA Agent)_
