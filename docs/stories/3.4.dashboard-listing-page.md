# Story 3.4: Dashboard Listing Page

## Status
Dev Complete - Pending Manual Test

## Story
**As a** user,
**I want** to view all dashboards available for my selected tenant,
**so that** I can choose which dashboard to open.

## Acceptance Criteria
1. app/tenant/[tenant_slug]/page.tsx created for dashboard listing
2. Page fetches GET /api/tenant/{tenant_id}/dashboards using tenant-scoped token on mount
3. Page displays tenant name in header/breadcrumb area
4. Dashboard cards displayed in grid layout (2-3 columns responsive)
5. Each card shows: dashboard title, description, thumbnail placeholder, "Open Dashboard" button
6. Cards styled with Tailwind CSS consistent with app theme
7. On "Open Dashboard" click, navigates to /tenant/[tenant_slug]/dashboard/[dashboard_slug]
8. If no dashboards assigned, displays message: "No dashboards available for this tenant"
9. Loading state shown while fetching dashboards
10. Error handling for API failures with retry option
11. Page includes tenant switcher dropdown in header (shows current tenant, allows switching back to selection)
12. TypeScript interfaces for dashboard list response

## Tasks / Subtasks

- [x] **Task 1: Create dashboard listing page** (AC: 1)
  - [x] Create `apps/shell-ui/app/tenant/[tenant_slug]/page.tsx`
  - [x] Set up dynamic route for tenant_slug
  - [x] Add page metadata and title

- [x] **Task 2: Fetch dashboard list** (AC: 2, 9, 10)
  - [x] Fetch GET /api/tenant/{tenant_id}/dashboards
  - [x] Use tenant-scoped token from tenant store
  - [x] Handle loading state
  - [x] Handle errors (401, 403, 404, network)
  - [x] Add retry button for failures

- [x] **Task 3: Create dashboard grid layout** (AC: 4, 5, 6)
  - [x] Display cards in responsive grid (2-3 columns)
  - [x] Show dashboard title, description
  - [x] Add placeholder thumbnail (icon or image)
  - [x] Add "Open Dashboard" button
  - [x] Style with Tailwind CSS

- [x] **Task 4: Implement navigation** (AC: 7)
  - [x] On button click, navigate to dashboard view
  - [x] Route: /tenant/[tenant_slug]/dashboard/[dashboard_slug]
  - [x] Pass dashboard context

- [x] **Task 5: Add tenant header** (AC: 3, 11)
  - [x] Display tenant name in header
  - [x] Add tenant switcher dropdown
  - [x] Link back to tenant selection (/)
  - [x] Show current tenant highlighted

- [x] **Task 6: Handle empty state** (AC: 8)
  - [x] Check if dashboards array empty
  - [x] Display "No dashboards available" message
  - [x] Style with center alignment and helpful text

- [x] **Task 7: Define TypeScript interfaces** (AC: 12)
  - [x] Define DashboardListItem interface
  - [x] Match API response structure
  - [x] Export from types/dashboard.ts

## Dev Notes

### Project Context
This is the **fourth story** in Epic 3. This page displays tenant-specific dashboards, demonstrating that the tenant-scoped token correctly filters which dashboards are visible.

### Expected Dashboard Assignments
[Source: Epic 1 Story 1.3 seed data]

- **Acme Corporation:** 2 dashboards
  - Customer Lifetime Value
  - Risk Analysis
  
- **Beta Industries:** 1 dashboard
  - Risk Analysis

This differentiation demonstrates tenant isolation at the dashboard assignment level.

### Dependencies
- **Depends on:** Story 3.3 (Tenant Selection) - provides tenant context
- **Depends on:** Epic 2 Story 2.4 (Tenant Metadata API) - /api/tenant/{id}/dashboards
- **Blocks:** Story 3.5 (Debug Panel) - page will include debug panel
- **Blocks:** Epic 5 (Dashboard Embedding) - provides navigation to embed view

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-15 | 0.1 | Initial story creation from Epic 3 PRD | Sarah (PO Agent) |
| 2025-10-15 | 1.0 | Implementation complete | James (Dev Agent) |

## Dev Agent Record

### Agent Model Used
- Model: claude-sonnet-4-5-20250929
- Agent: Dev Agent (James)
- Date: 2025-10-15

### Debug Log References
None - implementation completed without errors.

### Completion Notes List

**Implementation Complete:**

1. **TypeScript Interfaces Created** (types/dashboard.ts)
   - Dashboard interface: `{dashboard_id, name, slug, description, framework, entry_point, config_json}`
   - DashboardListResponse interface: `{tenant_id, tenant_name, dashboards[]}`
   - Support for custom icons and thumbnails via config_json

2. **Dynamic Route Created** (app/tenant/[tenant_slug]/page.tsx)
   - Next.js dynamic route with `[tenant_slug]` parameter
   - Uses `useParams()` to extract tenant slug from URL
   - Validates tenant slug matches selected tenant
   - Protected with AuthGuard

3. **Dashboard Fetch Implementation** (page.tsx:23)
   - Fetches GET `/api/tenant/{tenant_id}/dashboards`
   - Uses tenant-scoped token from zustand tenant store
   - Bearer token authentication
   - Error handling for 401 (invalid token), 403 (access denied), 404 (not found)
   - Network error handling with user-friendly messages

4. **Dashboard Grid Layout** (page.tsx:251)
   - Responsive grid: 1/2/3 columns (mobile/tablet/desktop)
   - Each card shows: title, description, framework, slug
   - Thumbnail/icon placeholder with gradient background
   - Framework-specific emoji icons (ðŸ“Š Dash, ðŸ“ˆ Streamlit, ðŸ“‰ Other)
   - "Open Dashboard" button with hover effects
   - Consistent Tailwind CSS styling

5. **Tenant Header with Switcher** (page.tsx:146)
   - Breadcrumb navigation showing tenant hierarchy
   - Current tenant name displayed prominently
   - Tenant switcher dropdown with current tenant highlighted
   - "Switch Tenant" button redirects to home (/)
   - Clickable breadcrumb for easy navigation

6. **Navigation to Dashboard View** (page.tsx:81)
   - "Open Dashboard" button navigates to `/tenant/[tenant_slug]/dashboard/[dashboard_slug]`
   - Uses Next.js `router.push()`
   - Passes tenant and dashboard context via URL

7. **Empty State Handling** (page.tsx:225)
   - Checks if `dashboards.length === 0`
   - Displays centered message: "No dashboards available for this tenant"
   - Icon illustration (dashboard icon)
   - "Switch Tenant" button for easy recovery
   - Helpful text directing users to contact admin

8. **Loading and Error States** (page.tsx:100)
   - Loading spinner during dashboard fetch
   - Error display with icon, message, and retry button
   - Retry button reloads page
   - "Switch Tenant" button in error state
   - Dashboard count info at bottom of grid

**Architecture Decisions:**
- Used Next.js dynamic routes for tenant isolation
- Tenant token from zustand store (separate from user token)
- Framework-specific icons for visual differentiation
- Breadcrumb navigation for clear hierarchy
- Tenant slug validation prevents URL manipulation
- Protected route with AuthGuard

**Expected Dashboard Assignments:**
- Acme Corporation: 2 dashboards (Customer Lifetime Value, Risk Analysis)
- Beta Industries: 1 dashboard (Risk Analysis)
- Demonstrates tenant isolation at dashboard level âœ“

**Testing Status:**
- All 12 Acceptance Criteria implemented
- All 7 tasks completed
- Manual testing pending (requires Docker services)

**Integration Points:**
- Uses zustand tenant store for tenant context
- Uses tenant-scoped token for API calls
- Ready for Story 3.5 (Debug Panel integration)
- Ready for Epic 5 (Dashboard Embedding - navigation target exists)

### File List
**Created:**
- types/dashboard.ts (19 lines)
- app/tenant/[tenant_slug]/page.tsx (310 lines)

**Modified:**
- None

## QA Results
_(To be filled by QA Agent)_
